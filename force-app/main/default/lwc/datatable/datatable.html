<template>
    <lightning-card title="Contacts" icon-name="standard:contact_list">
        <div class="slds-grid slds-wrap">
            <div class="slds-col slds-size_12-of-12 slds-medium-size_6-of-12">
                <div class="slds-m-around_medium">
                    <lightning-input type="search" label="Search Contacts" onchange={handleSearch}
                        value={searchKey}></lightning-input>
                </div>
            </div>
        </div>

        <div class=" slds-scrollable_x slds-m-around_medium">
            <table class="slds-table slds-table_bordered slds-table_fixed-layout slds-table_resizable-cols" role="grid">
                <thead>
                    <tr class="slds-line-height_reset">
                        <th class="" scope="col" style="width: 5%;">
                            <a class="slds-th__action slds-text-link_reset" role="button" tabindex="0" name="Actions">
                                Edit
                            </a>
                        </th>
                        <th class="" scope="col" style="width: 5%;">
                            <a class="slds-th__action slds-text-link_reset" role="button" tabindex="0" name="Actions">
                                View
                            </a>
                        </th>
                        <th class="" scope="col">
                            <a class="slds-th__action slds-text-link_reset" role="button" tabindex="0"
                                onclick={sortRecs} name="AccountName">
                                Account Name
                                <lightning-icon icon-name="utility:arrowup" size="x-small"
                                    lwc:if={nameUpBool}></lightning-icon>
                                <lightning-icon icon-name="utility:arrowdown" size="x-small"
                                    lwc:if={nameDWBool}></lightning-icon>
                            </a>
                        </th>

                        <th class="" scope="col">
                            <a class="slds-th__action slds-text-link_reset" role="button" tabindex="0"
                                onclick={sortRecs} name="FirstName">
                                First Name
                                <lightning-icon icon-name="utility:arrowup" size="x-small"
                                    lwc:if={FirstNameUpBool}></lightning-icon>
                                <lightning-icon icon-name="utility:arrowdown" size="x-small"
                                    lwc:if={FirstNameDWBool}></lightning-icon>
                            </a>
                        </th>

                        <th class="" scope="col">
                            <a class="slds-th__action slds-text-link_reset" role="button" tabindex="0"
                                onclick={sortRecs} name="LastName">
                                Last Name
                                <lightning-icon icon-name="utility:arrowup" size="x-small"
                                    lwc:if={LastNameUpBool}></lightning-icon>
                                <lightning-icon icon-name="utility:arrowdown" size="x-small"
                                    lwc:if={LastNameDWBool}></lightning-icon>
                            </a>
                        </th>

                        <th class="" scope="col">
                            <a class="slds-th__action slds-text-link_reset" role="button" tabindex="0"
                                onclick={sortRecs} name="Email">
                                Email
                                <lightning-icon icon-name="utility:arrowup" size="x-small"
                                    lwc:if={EmailUpBool}></lightning-icon>
                                <lightning-icon icon-name="utility:arrowdown" size="x-small"
                                    lwc:if={EmailDWBool}></lightning-icon>
                            </a>
                        </th>
                        <th class="" scope="col">
                            <a class="slds-th__action slds-text-link_reset" role="button" tabindex="0"
                                onclick={sortRecs} name="Date">
                                CreateDate
                                <lightning-icon icon-name="utility:arrowup" size="x-small"
                                    lwc:if={DateUpBool}></lightning-icon>
                                <lightning-icon icon-name="utility:arrowdown" size="x-small"
                                    lwc:if={DateDwBool}></lightning-icon>
                            </a>
                        </th>
                        <th class="" scope="col">
                            <a class="slds-th__action slds-text-link_reset" role="button" tabindex="0"
                                onclick={sortRecs} name="Days">
                                Days
                                <lightning-icon icon-name="utility:arrowup" size="x-small"
                                    lwc:if={DaysUpBool}></lightning-icon>
                                <lightning-icon icon-name="utility:arrowdown" size="x-small"
                                    lwc:if={DaysDwBool}></lightning-icon>
                            </a>
                        </th>

                        <th class="slds-cell_action-mode" scope="col" style="width:2rem">
                            <div class="slds-truncate slds-assistive-text" title="Actions">Actions</div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <template for:each={wrapperList} for:item="data">
                        <tr class="slds-hint-parent" key={data.Id}>
                            <!-- <td data-label="Action" scope="row">
                                <div class="slds-truncate" title={data.AccountId}>
                                    <lightning-icon class="slds-button" size="x-small" icon-name="action:new_task" alternative-text="New Task" title="New task" style="cursor:pointer;"></lightning-icon>
                                </div>
                            </td> -->
                            <td data-label="Select" scope="row">
                                <div class="slds-truncate" title={data.AccountId}>
                                    <!-- Custom Popup -->
                                    <!-- <a onclick={openQuickActionPanel} data-acc-id={data.AccountId} data-cont-id={data.Id}>Select</a> -->
                                    
                                    <!-- Standard Popup -->
                                    
                                    <a href="javascript:void(0);" onclick={editDetail} target="_blank" data-acc-id={data.AccountId} data-cont-id={data.Id}>Select (Standard edit)</a>
                                    
                                    <!-- FieldSet -->
                                    <!-- <a onclick={editFormDetails} target="_blank" data-acc-id={data.AccountId} data-cont-id={data.Id}>Select</a> -->

                                </div>
                            </td>
                            <td data-label="View" scope="row">
                                <div class="slds-truncate" title={data.AccountId}>
                                    <a onclick={viewDetail} target="_blank" data-acc-id={data.AccountId}
                                        data-cont-id={data.Id}>View</a>
                                </div>
                            </td>
                            <td data-label="Account Name" scope="row">
                                <div class="slds-truncate" title={data.Account.Name}>
                                    <a onclick={navigateToAccount} target="_blank" data-account-id={data.AccountId}
                                        data-contact-id={data.Id}>{data.Account.Name}</a>
                                </div>
                            </td>
                            <td data-label="First Name">
                                <div class="slds-truncate" title={data.FirstName}>{data.FirstName}</div>
                            </td>
                            <td data-label="Last Name">
                                <div class="slds-truncate" title={data.LastName}>{data.LastName}</div>
                            </td>
                            <td data-label="Email">
                                <div class="slds-truncate" title={data.Email}>
                                    <a href="#">{data.Email}</a>
                                </div>
                            </td>
                            <td data-label="CreateDate">
                                <div class="slds-truncate" title={data.CreateDate}>
                                    <a href="#">{data.date}</a>
                                </div>
                            </td>
                            <td data-label="Days">
                                <div class="slds-truncate" title={data.Days}>
                                    <a href="#" class={data.colorText}>{data.days}</a>
                                    <!-- <a href="#" class={colorText}>{data.days}</a> -->
                                </div>
                            </td>
                            <td role="gridcell" style="width:3.25rem">
                                <lightning-button-menu alternative-text="Show menu" variant="border-filled" icon-size="x-small" >                                    
                                    <lightning-menu-item value="MenuItemOne" label="Menu Item One"></lightning-menu-item>
                                    <lightning-menu-item value="MenuItemTwo" label="Menu Item Two"></lightning-menu-item>
                                    <lightning-menu-item value="MenuItemThree" label="Menu Item Three"></lightning-menu-item>
                                    <lightning-menu-item value="MenuItemFour" label="Menu Item Four"></lightning-menu-item>
                                    
                                </lightning-button-menu>
                            </td>
                        </tr>

                    </template>
                </tbody>
            </table>
        </div>
    </lightning-card>

    <!-- Modal for fieldset  -->
    <template if:true={isRenderFieldForm}>

        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
            class="slds-modal slds-fade-in-open slds-modal_medium">
            <div class="slds-modal__container">
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                    onclick={cancelHandler}>
                    <lightning-icon icon-name='utility:close' alternative-text='close' size='x-small'
                        title='close'></lightning-icon>
                    <span class="slds-assistive-text">Cancel and close</span>
                </button>
                <div class="slds-modal__header">
                    <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Contact Details</h1>
                </div>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <lightning-record-edit-form record-id={recordId} object-api-name={objectName}
                        onsuccess={handleSuccess} onsubmit={validateFields} onerror={handleError}>
                        <lightning-messages data-id="message">
                        </lightning-messages>
                        <div class="slds-grid slds-wrap">
                            <template if:true={fields}>
                                <template for:each={fields} for:item="f">
                                    <div key={f.Id} class="slds-col slds-size_1-of-2">
                                        <lightning-input-field field-name={f.APIName}></lightning-input-field>
                                    </div>
                                </template>
                            </template>
                        </div>
                        <lightning-button type="submit" variant="brand" label="Save"
                            onclick={saveClick}></lightning-button>
                    </lightning-record-edit-form>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>

    <!-- Modal for update the contact details -->
    <template if:true={isModalOpen}>

        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-02"
            class="slds-modal slds-fade-in-open slds-modal_medium">
            <div class="slds-modal__container">
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse">
                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                        <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#close"></use>
                    </svg>
                    <span class="slds-assistive-text">Cancel and close</span>
                </button>
                <div class="slds-modal__header">
                    <h1 id="modal-heading-02" class="slds-modal__title slds-hyphenate">Contact Details</h1>
                </div>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-2">
                    <template lwc:if={message}>
                        <p class="slds-text-align_center">{message}</p>
                    </template>
                    <template lwc:else>
                        <div class="slds-box">
                            <div class="slds-text-heading_small slds-p-bottom_medium slds-text-title_bold">This is
                                individual contact details.</div>
                            <template for:each={showList} for:item="list">
                                <div class="slds-m-left_medium" key={list.Id}>
                                    <!-- <lightning-input label="Account Id" value={list.AccountId} data-field="AccountId" onchange={handleChange} class="slds-m-bottom_x-small" required></lightning-input>
                                <lightning-input label="Contact Id" value={list.Id} data-field="ContactId" onchange={handleChange} class="slds-m-bottom_x-small" required></lightning-input> -->

                                    <input type="hidden" value={list.AccountId} data-field="AccountId"
                                        onchange={handleChange} class="slds-m-bottom_x-small" required></input>
                                    <input type="hidden" value={list.Id} data-field="ContactId" onchange={handleChange}
                                        class="slds-m-bottom_x-small" required></input>
                                    <lightning-input label="First Name" value={list.FirstName} data-field="FirstName"
                                        onchange={handleChange} class="slds-m-bottom_x-small"
                                        required></lightning-input>
                                    <lightning-input label="Last Name" value={list.LastName} data-field="LastName"
                                        onchange={handleChange} class="slds-m-bottom_x-small"
                                        required></lightning-input>
                                </div>
                            </template>
                        </div>

                    </template>

                </div>
                <!-- <div class="slds-modal__footer"> -->
                <div class="slds-modal__footer">
                    <lightning-button class="slds-m-right_x-small" label="Update" aria-label="Update"
                        disabled={disabled} onclick={updateHandler}></lightning-button>
                    <lightning-button class="slds-m-left_x-small" label="Cancel" aria-label="Cancel" disabled={disabled}
                        onclick={cancelHandler}></lightning-button>

                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>
    <!-- <c-account-table></c-account-table> -->
</template>