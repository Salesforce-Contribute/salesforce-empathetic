<template>

    <div class="slds-table_header-fixed_container slds-scrollable_x" onmousemove={handlemousemove} onmouseup={handlemouseup} ondblclick={handledblclickresizable}>
        <table aria-multiselectable="true" class="slds-table slds-table_header-fixed slds-table_bordered slds-table_edit slds-table_resizable-cols slds-tree slds-table_tree" role="treegrid" aria-label="Example default tree grid" style="table-layout: fixed;">
            <thead>
                <tr class="slds-line-height_reset">
                    <template lwc:if={hideColumn}>
                        <th class="slds-text-align_right" scope="col" style="width:2rem"></th>
                    </template>
                    <template for:each={labelList} for:item="col">
                        <template lwc:if={col.sortable}>
                            <th key={col.fieldName} aria-sort="none" style={fixedWidth} class="slds-is-resizable dv-dynamic-width slds-has-button-menu slds-is-resizable slds-is-sortable" scope="col">
                                <div class="slds-cell-fixed" style={fixedWidth}>
                                    <a class="slds-th__action slds-text-link_reset" href="#" role="button" tabindex="-1" onclick={sortByColumn}>
                                        <span class="slds-assistive-text">Sort by: </span>
                                        <div class="slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate" data-icon-name={col.sortIconTitle} onmouseenter={mouseEnter} onmouseout={mouseOut} onmouseleave={mouseLeave} data-label={col.fieldName}>
                                            <span class="slds-truncate" data-label={col.fieldName} data-icon-name={col.sortIconTitle} title={col.label}>{col.label}</span>
                                            <span class="slds-m-left_xx-small slds-icon_container slds-icon-utility-arrowdown" >
                                                <lightning-icon class={col.hoverClass} icon-name={col.sortIconName}  alternative-text={col.sortIconTitle} size='xx-small' data-label={col.fieldName} data-icon-name={col.sortIconTitle} title={col.sortIconTitle}></lightning-icon>
                                            </span>
                                        </div>
                                    </a>
                                    <button class="slds-button slds-button_icon slds-th__action-button slds-button_icon-x-small" aria-haspopup="true" tabindex="-1">
                                        <lightning-icon icon-name='utility:chevrondown' alternative-text='chevrondown' size='xx-small' title='chevrondown'></lightning-icon>
                                    </button>
                                    <div class="slds-resizable">
                                        <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                            <span class="slds-resizable__divider"></span>
                                        </span>
                                    </div>
                                </div>
                            </th>
                        </template>
                        <template lwc:else>
                            <th key={col.fieldName} aria-sort="none" style={fixedWidth} class="slds-is-resizable dv-dynamic-width slds-has-button-menu slds-is-resizable slds-is-sortable" scope="col">
                                <div class="slds-cell-fixed" style={fixedWidth}>
                                    <a class="slds-th__action slds-text-link_reset" href="#" role="button" tabindex="-1" >
                                        <span class="slds-assistive-text">Sort by: </span>
                                        <div class="slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate" >
                                            <span class="slds-truncate" data-label={col.fieldName} title={col.label}>{col.label}</span>
                                        </div>
                                    </a>
                                    <button class="slds-button slds-button_icon slds-th__action-button slds-button_icon-x-small" aria-haspopup="true" tabindex="-1" title="Show column actions">
                                        <lightning-icon icon-name='utility:chevrondown' alternative-text='chevrondown' size='xx-small' title='chevrondown'></lightning-icon>
                                    </button>
                                    <div class="slds-resizable">
                                        <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                            <span class="slds-resizable__divider"></span>
                                        </span>
                                    </div>
                                </div>
                            </th>
                        </template>
                    </template>
                </tr>
            </thead>
            <tbody>
                <template for:each={dataList} for:item="data" for:index="index">
                    <tr class="slds-hint-parent" key={data.Id} id={data.Id} aria-expanded={data.isExpand} aria-level="1" aria-posinset="2" aria-selected="false" aria-setsize="4" data-row-key-value={data.Id} data-row-number={data.rowNumber}>
                        <template lwc:if={hideColumn}>
                            <td class="slds-text-align_right" role="gridcell" style="width:3.25rem">
                                <div class="slds-checkbox">
                                    <lightning-input type="checkbox" checked={data.isSelected} onchange={singleSelection}  data-id={data.Id} name={data.Id}></lightning-input>
                                </div>
                            </td>
                        </template>
                        <td class="slds-tree__item" data-label={data.col1} scope="row">
                            <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={data.col1}>
                                <button class="slds-button slds-button_icon slds-button_icon-xx-small slds-m-right_x-small" aria-hidden="false" tabindex="-1" title={data.col1} onclick={toggleExpand}>
                                    <lightning-icon icon-name={data.expandIconName} alternative-text={data.expandIcontitle} size='xx-small' title={data.expandIcontitle} data-row-title={data.col1} data-row-key-value={data.Id} data-row-number={data.rowNumber} data-aria-expanded={data.isExpand}></lightning-icon>
                                    <span class="slds-assistive-text">{data.col1}</span>
                                </button>
                                <a href={data.smturl} tabindex="-1">{data.col1}</a>
                            </div>
                        </td>
                        <td data-label={data.col2} role="gridcell">
                            <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={data.col2}>{data.col2}</div>
                        </td>
                        <td data-label={data.col3} role="gridcell">
                            <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={data.col3}>{data.col3}</div>
                        </td>
                        <td data-label={data.col4} role="gridcell">
                            <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={data.col4}>{data.col4}</div>
                        </td>
                        <td data-label={data.col5} role="gridcell">
                            <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={data.col5}>{data.col5}</div>
                        </td>
                        <td data-label={data.col6} role="gridcell">
                            <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={data.col6}>{data.col6}</div>
                        </td>
                        <td data-label={data.col7} role="gridcell">
                            <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={data.col7}>{data.col7}</div>
                        </td>
                        <td data-label={data.col8} role="gridcell">
                            <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={data.col8}>{data.col8}</div>
                        </td>
                        <td role="gridcell" class="slds-cell_action-mode">
                            <lightning-button-menu menu-alignment="auto" alternative-text="Show menu" variant="border-filled" icon-size="x-small" >
                                <template for:each={data.rowAction} for:item="action" for:index="index">
                                    <lightning-menu-item key={data.Id} value={data} label={action.label} data-menu-label={action.label} data-menu-name={action.name} data-menu-id={data.Id} onclick={clickmenuitem}></lightning-menu-item>
                                </template>
                            </lightning-button-menu>
                        </td>
                    </tr>

                    <template lwc:if={data._children}>
                        <template lwc:if={data.isExpand}>
                            <template for:each={data._children} for:item="child1">
                                <tr key={data.Id} id={child1.Id} aria-expanded={child1.isExpand} aria-level="2" aria-posinset="1" aria-selected="false" aria-setsize="1" class="slds-hint-parent" data-row-key-value={child1.Id} data-row-number={child1.rowNumber}>
                                    <template lwc:if={hideColumn}>
                                        <th class="slds-text-align_right" role="gridcell" style="width:3.25rem">
                                            <!-- <template lwc:if={showChildHeader}>
                                                <div class="slds-checkbox">
                                                    <lightning-input type="checkbox" checked={child1.isSelected} id={child1.Id} name={child1.Id}></lightning-input>
                                                </div>
                                            </template> -->
                                        </th>
                                    </template>
                                    <td class="slds-tree__item" data-label={child1.col1} scope="row">
                                        <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={child1.col1}>
                                            <button class="slds-button slds-button_icon slds-button_icon-xx-small slds-m-right_x-small" aria-hidden="false" tabindex="-1" title={child1.col1} onclick={toggleExpand}>
                                                <lightning-icon icon-name={child1.expandIconName} alternative-text={child1.expandIcontitle} size='xx-small' title={child1.expandIcontitle} data-row-title={child1.col1} data-row-key-value={child1.Id} data-row-number={child1.rowNumber} data-aria-expanded={data.isExpand}></lightning-icon>
                                                <span class="slds-assistive-text">{child1.col1}</span>
                                            </button>
                                            <span tabindex="-1" class="slds-text-title_bold">{child1.col1}</span>
                                        </div>
                                    </td>
                                    <td data-label={child1.col2} role="gridcell">
                                        <div class="slds-truncate dv-dynamic-width slds-text-title_bold" style={fixedWidth} title={child1.col2}>{child1.col2}</div>
                                    </td>
                                    <td data-label={child1.col3} role="gridcell">
                                        <div class="slds-truncate dv-dynamic-width slds-text-title_bold" style={fixedWidth} title={child1.col3}>{child1.col3}</div>
                                    </td>
                                    <td data-label={child1.col4} role="gridcell">
                                        <div class="slds-truncate dv-dynamic-width slds-text-title_bold" style={fixedWidth} title={child1.col4}>{child1.col4}</div>
                                    </td>
                                    <td data-label={child1.col5} role="gridcell">
                                        <div class="slds-truncate dv-dynamic-width slds-text-title_bold" style={fixedWidth} title={child1.col5}>{child1.col5}</div>
                                    </td>
                                    <td data-label={child1.col6} role="gridcell">
                                        <div class="slds-truncate dv-dynamic-width slds-text-title_bold" style={fixedWidth} title={child1.col6}>{child1.col6}</div>
                                    </td>
                                    <td data-label={child1.col7} role="gridcell">
                                        <div class="slds-truncate dv-dynamic-width slds-text-title_bold" style={fixedWidth} title={child1.col7}>{child1.col7}</div>
                                    </td>
                                    <td data-label={child1.col8} role="gridcell">
                                        <div class="slds-truncate dv-dynamic-width slds-text-title_bold" style={fixedWidth} title={child1.col8}>{child1.col8}</div>
                                    </td>
                                    <td role="gridcell" style="width:3.25rem"></td>
                                </tr>
                                
                                <template lwc:if={child1._children}>
                                    <template lwc:if={child1.isExpand}>
                                        <template for:each={child1._children} for:item="child2" for:index="index">
                                            <tr key={child2.Id} id={child2.Id} aria-expanded={child2.isExpand} aria-level="3" aria-posinset="1" aria-selected="false" aria-setsize="1" class="slds-hint-parent" data-row-key-value={child2.Id} data-row-number={child2.rowNumber}>
                                                <template lwc:if={hideColumn}>
                                                    <td class="slds-text-align_right" role="gridcell" style="width:3.25rem">
                                                        <div class="slds-checkbox">
                                                            <lightning-input type="checkbox" checked={child2.isSelected} onchange={singleSelection} data-id={child2.Id} name={child2.Id}></lightning-input>
                                                        </div>
                                                    </td>
                                                </template>
                                                <td class="slds-tree__item" data-label={child2.col1} scope="row">
                                                    <button class="slds-button slds-button_icon slds-button_icon-xx-small slds-m-right_x-small" aria-hidden="false" tabindex="-1" title={child2.col1} onclick={toggleExpand}>
                                                        <lightning-icon icon-name={child2.expandIconName} alternative-text={child2.expandIcontitle} size='xx-small' title={child2.expandIcontitle} data-row-title={child2.col1} data-row-key-value={child2.Id} data-row-number={child2.rowNumber}></lightning-icon>
                                                        <span class="slds-assistive-text">{child2.col1}</span>
                                                    </button>
                                                    <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={child2.col1}>
                                                        <a href={child2.smturl} tabindex="-1">{child2.col1}</a>
                                                    </div>
                                                </td>
                                                <td data-label={child2.col2} role="gridcell">
                                                    <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={child2.col2}>{child2.col2}</div>
                                                </td>
                                                <td data-label={child2.col3} role="gridcell">
                                                    <div class="slds-truncate" title={child2.col3}>{child2.col3}</div>
                                                </td>
                                                <td data-label={child2.col4} role="gridcell">
                                                    <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={child2.col4}>{child2.col4}</div>
                                                </td>
                                                <td data-label={child2.col5} role="gridcell">
                                                    <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={child2.col5}>{child2.col5}</div>
                                                </td>
                                                <td data-label={child2.col6} role="gridcell">
                                                    <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={child2.col6}>{child2.col6}</div>
                                                </td>
                                                <td data-label={child2.col7} role="gridcell">
                                                    <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={child2.col7}>{child2.col7}</div>
                                                </td>
                                                <td data-label={child2.col8} role="gridcell">
                                                    <div class="slds-truncate dv-dynamic-width" style={fixedWidth} title={child2.col8}>{child2.col8}</div>
                                                </td>
                                                <td role="gridcell" class="slds-cell_action-mode">
                                                    <lightning-button-menu menu-alignment="auto" alternative-text="Show menu" variant="border-filled" icon-size="x-small">
                                                        <template for:each={child2.rowAction} for:item="action" for:index="index">
                                                            <lightning-menu-item key={child2.Id} value={child2} label={action.label} data-menu-label={action.label} data-menu-name={action.name} data-menu-id={child2.Id} onclick={clickmenuitem}></lightning-menu-item>
                                                        </template>
                                                    </lightning-button-menu>

                                                </td>
                                            </tr>
                                        </template> 
                                    </template>
                                </template>

                            </template>
                        </template>
                    </template>

                </template>

            </tbody>
        </table>
    </div>
</template>