<template>
    <lightning-button variant="brand" label="Add Product" title="Add Product" onclick={showModalBox}></lightning-button>
   <!-- modal start -->      
   <template if:true={isShowModal} >
    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_large">
       <div class="slds-modal__container">
        <!-- modal header start -->
          <header class="slds-modal__header">
             <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={hideModalBox}>
                <lightning-icon icon-name="utility:close" alternative-text="close" variant="inverse" size="small" ></lightning-icon>
                <span class="slds-assistive-text">Close</span>
             </button>
             <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Add Product</h2>
          </header>
      
          <!-- modal body start -->
          <div class="slds-modal__content slds-p-around_none" id="modal-content-id-1">
            <template lwc:if={nextBool}>
                        
                <div class="slds-form-element slds-p-around_small" style="background-color: #eeeeee;">
                    <div class="slds-form-element__control">
                        <input type="search" data-id="input-search" name="search" value={searchKey} 
                        onkeyup={filterProducts} placeholder="Search Product here..."/>                         
                        
                        <lightning-button-icon icon-name="utility:filterList"  size="medium" onclick={showFilterBox} alternative-text="Filter" class="slds-m-left_xx-small slds-float_right"></lightning-button-icon>
                        
                    </div>
                    <div class="slds-form-element__control slds-p-top_medium">
                        
                        <template lwc:if={manageShowCount}>
                            <template lwc:if={showCount}>
                                <span style="color:rgb(1, 141, 235); cursor:pointer;" onclick={viewSelecteHandler}>Show Selected: {count}</span>
                            </template>
                            <template lwc:else>
                                <p>Show Selected: {count}</p>
                            </template>
                        </template>
                        <template lwc:if={showViewAll}>
                            <span style="color:rgb(1, 141, 235); cursor:pointer;" onclick={viewAllHandler}>Back To Result</span>
                        </template>
                        <template lwc:if={showBackToSearch}>
                            <span style="color:rgb(1, 141, 235); cursor:pointer;" onclick={backToSearchHandler}>Back To Search</span>
                        </template>
                        
                        <!-- <template lwc:if={viewSelected}>
                            <p><button class="slds-button" onclick={viewSelecteHandler}>View Selected: {count}</button></p>
                        </template> -->
                    </div>
                </div>
                
            </template>

            <div class="slds-grid slds-wrap">
                <!-- column first end -->
                <div class="slds-col slds-size_12-of-12" data-id="col-table">
                    <template lwc:if={nextBool}>
                        <div class="slds-table--header-fixed_container" style="height:17rem;" >
                        <div class="slds-scrollable_y" style="height:17rem;" tabindex="0">
                        <table aria-multiselectable="true" class="slds-table slds-table_cell-buffer slds-table_bordered slds-table--header-fixed " role="grid" >
                            <thead>
                                    <tr class="slds-line-height_reset">
                                        <th  style="width:2rem">
                                            <!-- <div class="slds-truncate slds-cell-fixed"> -->
                                                <lightning-input type="checkbox" checked={keepSelected} data-id="headerCheck" name="headerCheckInput" onchange={selectAllHandler}></lightning-input>
                                            <!-- </div> -->
                                        </th>
                                        <th scope="col" >
                                            <div class="slds-truncate slds-cell-fixed">Product Name</div>
                                        </th>
                                        <th scope="col" >
                                            <div class="slds-truncate slds-cell-fixed">Product Code</div>
                                        </th>
                                        <th scope="col" >
                                            <div class="slds-truncate slds-cell-fixed">List Price</div>
                                        </th>
                                        <th scope="col" >
                                            <div class="slds-truncate slds-cell-fixed">Product Description</div>
                                        </th>
                                        <th scope="col" >
                                            <div class="slds-truncate slds-cell-fixed">Product Family</div>
                                        </th>
                
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={dataList} for:item="item">
                                    <tr class="slds-hint-parent" key={item.Id} >
                                        <td>
                                            <!-- <div class="slds-truncate"> -->
                                                <lightning-input type="checkbox" data-id={item.Id} name="rowCheckInput" checked={item.isSelected} onchange={selectHandler} data-check-id={item.Id}></lightning-input>
                                            <!-- </div> -->
                                        </td>                      
                                        <td><div class="slds-truncate">{item.Name}</div></td>
                                        <td><div class="slds-truncate">{item.ProductCode}</div></td>
                                        <td><div class="slds-truncate">{item.UnitPrice}</div></td>
                                        <td><div class="slds-truncate">{item.Description}</div></td>
                                        <td><div class="slds-truncate">{item.Family}</div></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        </div>
                    </div>
                    </template>
                    <template lwc:else>
                        <table aria-multiselectable="true" class="slds-table slds-table_cell-buffer slds-table_bordered">
                            <thead>
                                <tr>
                                    <td>#</td>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Sales Price</th>
                                    <th>Date</th>
                                    <th>Line Description</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={selectedList} for:item="data">
                                    
                                    <tr key={data.PricebookEntryId}>
                                        <td></td>
                                        <td>{data.productName}</td>
                                        <td><input type="number" data-id="input-quantity" name="quantity" value={data.quantity} data-target-id={data.PricebookEntryId} onchange={onChangeQuantity}/></td>
                                        <td><input type="number" data-id="input-salesprice" name="salesprice" value={data.salesPrice} data-target-id={data.PricebookEntryId} onchange={onChangeSalesprice}/></td>
                                        <td><input type="date" data-id="input-date" name="date" value={data.serviceDate} data-target-id={data.PricebookEntryId} onchange={onChangeServiceDate}/></td>
                                        <td><input type="text" data-id="input-lineDesc" name="lineDesc" value={data.lineDescription} data-target-id={data.PricebookEntryId} onchange={onChangeLineDescription}/></td>
                                        <td>
                                            <button onclick={deleteHandler} data-pricebookentry-id={data.PricebookEntryId} style="border:1px solid gray; background-color: transparent;">
                                                <lightning-icon icon-name='utility:delete' alternative-text='delete' size='xx-small' title='delete' ></lightning-icon>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </template>
                </div>
                <!-- column first end -->
                <!-- column second start -->
                <div data-id="col-filter"  style="height: 17rem;">
                    <template lwc:if={filterBox}>
    
                        <div class="slds-panel slds-panel_docked slds-panel_docked-right slds-is-open" aria-hidden="false">
                            <div class="slds-panel__header">
                                <h2 class="slds-panel__header-title slds-text-heading_small slds-truncate" title="Panel Header">Quick Filters </h2>
                                <div class="slds-panel__header-actions">
                                    <lightning-button-icon icon-name='utility:close' alternative-text='close' size='x-small' title='close' onclick={hideFilterBox}></lightning-button-icon>
                                </div>
                            </div>
                            <div class="slds-panel__body">
                                <div class="slds-form-element">
                                    <div class="slds-clearfix">
                                        <div class="slds-float_left">
                                          <label class="slds-form-element__label" for="text-input-id-49">Product Code</label>
                                        </div>
                                        <div class="slds-float_right">
                                          <button class="slds-button slds-float_right" onclick={cancleHandler}>Clear</button>
                                        </div>
                                      </div>
                                    <div class="slds-form-element__control">
                                        <input type="text" class="input-product_code" data-id="input-product_code" name="product-code" onkeyup={filterInput} value={filterSearchKey}/>
                                    </div>

                                </div>
                                <fieldset class="slds-form-element slds-is-required">
                                    <legend class="slds-form-element__legend slds-form-element__label">Product Family</legend>
                                    
                                    <template for:each={options} for:item="optns">
                                        <lightning-input type="checkbox" key={optns.id} name="options" label={optns.opt} data-option-id={optns.id} onchange={optionsFilter}></lightning-input>
                                    </template>
                                    <div class="slds-float_right">
                                        <!-- <button class="slds-button slds-float_right" onclick={openDialog}>Show more</button> -->
                                        <!-- <c-dueling-picklist onPicklistOpen={openDialog}></c-dueling-picklist> -->
                                    </div>
                                </fieldset>
                            </div>
                            <template lwc:if={showFilterBoxFooter}>
                                <footer class="slds-modal__footer">
                                    <div class="slds-grid slds-gutters">
                                        <div class="slds-col">
                                            <div class="slds-float_left">
                                                <button class="slds-button slds-button_neutral slds-m-left_x-small" onclick={closeModal}>Cancel</button>
                                                <button class="slds-button" onclick={cancleHandler}>Clear All Filters</button>
                                            </div>
                                        </div>
                                        <div class="slds-col">
                                            <button class="slds-button slds-button_brand slds-m-left_x-small" onclick={filterApplyHandler}>Apply</button>
                                        </div>
                                    </div>
                                </footer>
                            </template>
                        </div>
                    </template>
                </div>
                <!-- column second start -->
            </div>

        </div>
        <!-- modal body end -->

          <!-- modal footer start-->
          <footer class="slds-modal__footer">
             <div class="slds-grid slds-gutters">
                <div class="slds-col">
                  <template lwc:if={backBool}>
                      <div class="slds-float_left">
                          <button class="slds-button slds-button_brand slds-m-left_x-small" onclick={backHandler}>Back</button>
                      </div>
                  </template>
                </div>
                <div class="slds-col">
                    <button class="slds-button slds-button_neutral slds-m-left_x-small" onclick={hideModalBox}>Cancel</button>
                    <template lwc:if={nextBool}>
                        <button class="slds-button slds-button_brand slds-m-left_x-small" disabled={bool} onclick={nextHandler}>Next</button>
                    </template>
                    <template lwc:else>
                        <button class="slds-button slds-button_brand slds-m-left_x-small" onclick={saveHandler}>Save</button>
                    </template>
                </div>
              </div>
          </footer>
       
       </div>
    </section>
    <!-- <div class="slds-backdrop slds-backdrop_open"></div> -->
 </template>
 <!-- modal end -->

</template>